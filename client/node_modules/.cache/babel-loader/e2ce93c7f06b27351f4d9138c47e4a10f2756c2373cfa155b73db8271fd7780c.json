{"ast":null,"code":"import axios from'axios';import{USER_LOGIN_REQUEST,USER_LOGIN_SUCCESS,USER_LOGIN_FAIL,USER_LOGOUT,USER_REGISTER_REQUEST,USER_REGISTER_SUCCESS,USER_REGISTER_FAIL,USER_DETAILS_REQUEST,USER_DETAILS_SUCCESS,USER_DETAILS_FAIL,USER_DETAILS_RESET,USER_UPDATE_PROFILE_REQUEST,USER_UPDATE_PROFILE_SUCCESS,USER_UPDATE_PROFILE_FAIL}from'../constants/userConstants';import{ORDER_LIST_MY_RESET}from'../constants/orderConstants';import{CART_CLEAR_ITEMS}from'../constants/cartConstants';import{transferGuestCart,loadUserCart}from'./cartActions';// Helper function to get user-specific localStorage keys\nconst getUserKey=userId=>key=>`${key}_${userId}`;// Login action\nexport const login=(email,password)=>async dispatch=>{try{dispatch({type:USER_LOGIN_REQUEST});const config={headers:{'Content-Type':'application/json'}};const{data}=await axios.post('/api/users/login',{email,password},config);dispatch({type:USER_LOGIN_SUCCESS,payload:data});localStorage.setItem('userInfo',JSON.stringify(data));// Transfer any guest cart items to the user's cart\ndispatch(transferGuestCart());// Load the user's cart from the server\ndispatch(loadUserCart());}catch(error){dispatch({type:USER_LOGIN_FAIL,payload:error.response&&error.response.data.message?error.response.data.message:error.message});}};// Logout action\nexport const logout=()=>dispatch=>{// Get user ID before removing userInfo\nconst userInfo=JSON.parse(localStorage.getItem('userInfo'));const userId=userInfo===null||userInfo===void 0?void 0:userInfo._id;// Clear user data from localStorage\nlocalStorage.removeItem('userInfo');// Clear user-specific cart data if we have a userId\nif(userId){const getUserKeyWithId=getUserKey(userId);localStorage.removeItem(getUserKeyWithId('cartItems'));localStorage.removeItem(getUserKeyWithId('shippingAddress'));localStorage.removeItem(getUserKeyWithId('paymentMethod'));localStorage.removeItem(getUserKeyWithId('coupon'));}// Clear Redux state\ndispatch({type:USER_LOGOUT});dispatch({type:USER_DETAILS_RESET});dispatch({type:ORDER_LIST_MY_RESET});dispatch({type:CART_CLEAR_ITEMS});// Redirect to home page\nwindow.location.href='/';};// Register action\nexport const register=(name,email,password)=>async dispatch=>{try{dispatch({type:USER_REGISTER_REQUEST});const config={headers:{'Content-Type':'application/json'}};const{data}=await axios.post('/api/users',{name,email,password},config);dispatch({type:USER_REGISTER_SUCCESS,payload:data});// Auto login after registration\ndispatch({type:USER_LOGIN_SUCCESS,payload:data});localStorage.setItem('userInfo',JSON.stringify(data));// Transfer any guest cart items to the new user's cart\ndispatch(transferGuestCart());}catch(error){dispatch({type:USER_REGISTER_FAIL,payload:error.response&&error.response.data.message?error.response.data.message:error.message});}};// Get user details action\nexport const getUserDetails=id=>async(dispatch,getState)=>{try{dispatch({type:USER_DETAILS_REQUEST});const{userLogin:{userInfo}}=getState();const config={headers:{'Content-Type':'application/json',Authorization:`Bearer ${userInfo.token}`}};const{data}=await axios.get(`/api/users/${id}`,config);dispatch({type:USER_DETAILS_SUCCESS,payload:data});}catch(error){dispatch({type:USER_DETAILS_FAIL,payload:error.response&&error.response.data.message?error.response.data.message:error.message});}};// Update user profile action\nexport const updateUserProfile=user=>async(dispatch,getState)=>{try{dispatch({type:USER_UPDATE_PROFILE_REQUEST});const{userLogin:{userInfo}}=getState();const config={headers:{'Content-Type':'application/json',Authorization:`Bearer ${userInfo.token}`}};const{data}=await axios.put('/api/users/profile',user,config);dispatch({type:USER_UPDATE_PROFILE_SUCCESS,payload:data});// Update login state with new user data\ndispatch({type:USER_LOGIN_SUCCESS,payload:data});localStorage.setItem('userInfo',JSON.stringify(data));}catch(error){dispatch({type:USER_UPDATE_PROFILE_FAIL,payload:error.response&&error.response.data.message?error.response.data.message:error.message});}};","map":{"version":3,"names":["axios","USER_LOGIN_REQUEST","USER_LOGIN_SUCCESS","USER_LOGIN_FAIL","USER_LOGOUT","USER_REGISTER_REQUEST","USER_REGISTER_SUCCESS","USER_REGISTER_FAIL","USER_DETAILS_REQUEST","USER_DETAILS_SUCCESS","USER_DETAILS_FAIL","USER_DETAILS_RESET","USER_UPDATE_PROFILE_REQUEST","USER_UPDATE_PROFILE_SUCCESS","USER_UPDATE_PROFILE_FAIL","ORDER_LIST_MY_RESET","CART_CLEAR_ITEMS","transferGuestCart","loadUserCart","getUserKey","userId","key","login","email","password","dispatch","type","config","headers","data","post","payload","localStorage","setItem","JSON","stringify","error","response","message","logout","userInfo","parse","getItem","_id","removeItem","getUserKeyWithId","window","location","href","register","name","getUserDetails","id","getState","userLogin","Authorization","token","get","updateUserProfile","user","put"],"sources":["C:/Users/HP/CascadeProjects/food-ordering-system/client/src/actions/userActions.js"],"sourcesContent":["import axios from 'axios';\nimport {\n  USER_LOGIN_REQUEST,\n  USER_LOGIN_SUCCESS,\n  USER_LOGIN_FAIL,\n  USER_LOGOUT,\n  USER_REGISTER_REQUEST,\n  USER_REGISTER_SUCCESS,\n  USER_REGISTER_FAIL,\n  USER_DETAILS_REQUEST,\n  USER_DETAILS_SUCCESS,\n  USER_DETAILS_FAIL,\n  USER_DETAILS_RESET,\n  USER_UPDATE_PROFILE_REQUEST,\n  USER_UPDATE_PROFILE_SUCCESS,\n  USER_UPDATE_PROFILE_FAIL\n} from '../constants/userConstants';\nimport { ORDER_LIST_MY_RESET } from '../constants/orderConstants';\nimport { CART_CLEAR_ITEMS } from '../constants/cartConstants';\nimport { transferGuestCart, loadUserCart } from './cartActions';\n\n// Helper function to get user-specific localStorage keys\nconst getUserKey = (userId) => (key) => `${key}_${userId}`;\n\n// Login action\nexport const login = (email, password) => async (dispatch) => {\n  try {\n    dispatch({ type: USER_LOGIN_REQUEST });\n\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    const { data } = await axios.post(\n      '/api/users/login',\n      { email, password },\n      config\n    );\n\n    dispatch({\n      type: USER_LOGIN_SUCCESS,\n      payload: data,\n    });\n\n    localStorage.setItem('userInfo', JSON.stringify(data));\n    \n    // Transfer any guest cart items to the user's cart\n    dispatch(transferGuestCart());\n    \n    // Load the user's cart from the server\n    dispatch(loadUserCart());\n  } catch (error) {\n    dispatch({\n      type: USER_LOGIN_FAIL,\n      payload:\n        error.response && error.response.data.message\n          ? error.response.data.message\n          : error.message,\n    });\n  }\n};\n\n// Logout action\nexport const logout = () => (dispatch) => {\n  // Get user ID before removing userInfo\n  const userInfo = JSON.parse(localStorage.getItem('userInfo'));\n  const userId = userInfo?._id;\n  \n  // Clear user data from localStorage\n  localStorage.removeItem('userInfo');\n  \n  // Clear user-specific cart data if we have a userId\n  if (userId) {\n    const getUserKeyWithId = getUserKey(userId);\n    localStorage.removeItem(getUserKeyWithId('cartItems'));\n    localStorage.removeItem(getUserKeyWithId('shippingAddress'));\n    localStorage.removeItem(getUserKeyWithId('paymentMethod'));\n    localStorage.removeItem(getUserKeyWithId('coupon'));\n  }\n  \n  // Clear Redux state\n  dispatch({ type: USER_LOGOUT });\n  dispatch({ type: USER_DETAILS_RESET });\n  dispatch({ type: ORDER_LIST_MY_RESET });\n  dispatch({ type: CART_CLEAR_ITEMS });\n  \n  // Redirect to home page\n  window.location.href = '/';\n};\n\n// Register action\nexport const register = (name, email, password) => async (dispatch) => {\n  try {\n    dispatch({ type: USER_REGISTER_REQUEST });\n\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    const { data } = await axios.post(\n      '/api/users',\n      { name, email, password },\n      config\n    );\n\n    dispatch({\n      type: USER_REGISTER_SUCCESS,\n      payload: data,\n    });\n\n    // Auto login after registration\n    dispatch({\n      type: USER_LOGIN_SUCCESS,\n      payload: data,\n    });\n\n    localStorage.setItem('userInfo', JSON.stringify(data));\n    \n    // Transfer any guest cart items to the new user's cart\n    dispatch(transferGuestCart());\n  } catch (error) {\n    dispatch({\n      type: USER_REGISTER_FAIL,\n      payload:\n        error.response && error.response.data.message\n          ? error.response.data.message\n          : error.message,\n    });\n  }\n};\n\n// Get user details action\nexport const getUserDetails = (id) => async (dispatch, getState) => {\n  try {\n    dispatch({ type: USER_DETAILS_REQUEST });\n\n    const {\n      userLogin: { userInfo },\n    } = getState();\n\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${userInfo.token}`,\n      },\n    };\n\n    const { data } = await axios.get(`/api/users/${id}`, config);\n\n    dispatch({\n      type: USER_DETAILS_SUCCESS,\n      payload: data,\n    });\n  } catch (error) {\n    dispatch({\n      type: USER_DETAILS_FAIL,\n      payload:\n        error.response && error.response.data.message\n          ? error.response.data.message\n          : error.message,\n    });\n  }\n};\n\n// Update user profile action\nexport const updateUserProfile = (user) => async (dispatch, getState) => {\n  try {\n    dispatch({ type: USER_UPDATE_PROFILE_REQUEST });\n\n    const {\n      userLogin: { userInfo },\n    } = getState();\n\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${userInfo.token}`,\n      },\n    };\n\n    const { data } = await axios.put('/api/users/profile', user, config);\n\n    dispatch({\n      type: USER_UPDATE_PROFILE_SUCCESS,\n      payload: data,\n    });\n\n    // Update login state with new user data\n    dispatch({\n      type: USER_LOGIN_SUCCESS,\n      payload: data,\n    });\n\n    localStorage.setItem('userInfo', JSON.stringify(data));\n  } catch (error) {\n    dispatch({\n      type: USER_UPDATE_PROFILE_FAIL,\n      payload:\n        error.response && error.response.data.message\n          ? error.response.data.message\n          : error.message,\n    });\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}